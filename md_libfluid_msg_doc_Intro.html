<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, user-scalable=no">
        <meta name="generator" content="Doxygen 1.8.4"/>
        <title>libfluid: A quick intro to libfluid_msg</title>
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
          ga('create', 'UA-48360026-1', 'opennetworkingfoundation.github.io');
          ga('send', 'pageview');
        </script>
        <link href="tabs.css" rel="stylesheet" type="text/css"/>
        <script type="text/javascript" src="jquery.js"></script>
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="extra.css" rel="stylesheet" type="text/css"/>
        <link rel="icon" type="image/png" href="libfluid_favicon.png">        
    </head>
<body>
    <div id="top">
        <div id="titlearea">
            <a href="http://opennetworkingfoundation.github.io/libfluid/">
            <div id="projectlogo"><img alt="Logo" src="libfluid_logo.png"></div>
            <div id="projecttitle">
                <div id="projectname">libfluid</div>
                <div id="projectbrief">The ONF OpenFlow driver</div>
            </div>
            </a>
            <div id="resources">GitHub:
                <a href="https://github.com/OpenNetworkingFoundation/libfluid">libfluid</a> | 
                <a href="https://github.com/OpenNetworkingFoundation/libfluid_base">libfluid_base</a> | 
                <a href="https://github.com/OpenNetworkingFoundation/libfluid_msg">libfluid_msg</a><br />
                <a href="https://groups.google.com/forum/#!forum/libfluid">Mailing list</a>
            </div>
        </div>
<!-- Generated by Doxygen 1.8.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li class="current"><a href="pages.html"><span>Documentation</span></a></li>
      <li><a href="annotated.html"><span>API&#160;reference</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">A quick intro to libfluid_msg </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>libfluid_msg</b> is a library to create, serialize and deserialize OpenFlow 1.0 and OpenFlow 1.3 messages.</p>
<h2>Build and install</h2>
<p><b>libfluid_msg</b> has been tested on Ubuntu 12.04 and Fedora 19. It should run on other flavors of Linux. MacOS, Windows and BSD variations are currently not supported, but they should run with some simple changes (we plan to support them oficially in the future).</p>
<h3>Ubuntu 12.04</h3>
<p>Install the dependencies: </p>
<div class="fragment"><div class="line">$ sudo apt-<span class="keyword">get</span> install autoconf libtool build-essential pkg-config</div>
</div><!-- fragment --><p>Build: </p>
<div class="fragment"><div class="line">$ ./configure</div>
<div class="line">$ make</div>
<div class="line">$ sudo make install</div>
</div><!-- fragment --><p>Configure your system to find libraries in <code>/usr/local/lib</code>: </p>
<div class="fragment"><div class="line">$ sudo sh -c <span class="stringliteral">&quot;echo /usr/local/lib &gt; /etc/ld.so.conf.d/libfluid.conf&quot;</span></div>
<div class="line">$ sudo ldconfig</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>You can skip this last step by running <code>./configure --prefix=/usr</code> in the build.</p>
<p></p>
</blockquote>
<h3>Fedora 19</h3>
<p>Install the dependencies: </p>
<div class="fragment"><div class="line">$ sudo yum install autoconf automake gcc-g++ libtool</div>
</div><!-- fragment --><p>Build: </p>
<div class="fragment"><div class="line">$ ./configure</div>
<div class="line">$ make</div>
<div class="line">$ sudo make install</div>
</div><!-- fragment --><p>Configure your system to find libraries in <code>/usr/local/lib</code>: </p>
<div class="fragment"><div class="line">$ sudo sh -c <span class="stringliteral">&quot;echo /usr/local/lib &gt; /etc/ld.so.conf.d/libfluid.conf&quot;</span></div>
<div class="line">$ sudo ldconfig</div>
</div><!-- fragment --><h2>Usage</h2>
<p>To use OpenFlow 1.0 messages, you will need to include: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;fluid/of10msg.h&gt;</span></div>
</div><!-- fragment --><p>And for OpenFlow 1.3: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;fluid/of13msg.h&gt;</span></div>
</div><!-- fragment --><p>Link with your code with <code>-lfluid_msg</code>.</p>
<h2>Coding with libfluid_msg</h2>
<p><b>libfluid_msg</b> provides classes for all OpenFlow 1.0 and 1.3 message types along with classes that represent common structures. These classes have two methods to serialize and deserialize OpenFlow messages.</p>
<p>Here's how to pack a Hello message: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;fluid/of10msg.h&gt;</span>   </div>
<div class="line"><span class="keyword">using namespace </span>fluid_msg;</div>
<div class="line"></div>
<div class="line">[...]</div>
<div class="line"></div>
<div class="line"><a class="code" href="classfluid__msg_1_1of10_1_1Hello.html">of10::Hello</a> h();</div>
<div class="line">h.xid(42);</div>
<div class="line">uint8_t *buff = h.pack();</div>
<div class="line"></div>
<div class="line"><span class="comment">// Just an illustration of a method to send the message</span></div>
<div class="line"><span class="comment">// send(buff);</span></div>
<div class="line"><span class="comment">// delete [] buff;</span></div>
</div><!-- fragment --><p> The message is serialized into a binary format, ready to be sent through the wire. The user is responsible for the memory management of the generated packed message.</p>
<p>And then unpack another: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;fluid/of10msg.h&gt;</span>   </div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span>fluid_msg;</div>
<div class="line"></div>
<div class="line">[...]</div>
<div class="line"></div>
<div class="line"><span class="comment">// Message arrived from the OpenFlow Channel</span></div>
<div class="line"><a class="code" href="classfluid__msg_1_1of10_1_1Hello.html">of10::Hello</a> h;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Unpack and check for error</span></div>
<div class="line">of_error err = h.unpack(buff);</div>
</div><!-- fragment --><p> The unpack method returns an OpenFlow error message. Most of the error handling is related to the length of the messages, but some messages, like <a class="el" href="classfluid__msg_1_1of13_1_1FlowMod.html">fluid_msg::of13::FlowMod</a>, have other types of error checking. To retrieve the error type and code use the following functions:</p>
<div class="fragment"><div class="line">uint16_t err_type = of_error_type(err);</div>
<div class="line">uint16_t err_code = of_error_code(err);</div>
</div><!-- fragment --><p>Here is an example of how to create a message composed by other OpenFlow elements. To create a <a class="el" href="classfluid__msg_1_1of10_1_1FlowMod.html">fluid_msg::of10::FlowMod</a> message: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;fluid/of10msg.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span>fluid_msg;</div>
<div class="line"></div>
<div class="line">[...]</div>
<div class="line"></div>
<div class="line"><a class="code" href="classfluid__msg_1_1of10_1_1FlowMod.html">of10::FlowMod</a> fm();</div>
<div class="line"></div>
<div class="line"><span class="comment">// Creates Output Action with in_port=1 and send_len=1024</span></div>
<div class="line"><a class="code" href="classfluid__msg_1_1of10_1_1OutputAction.html">of10::OutputAction</a> oa(1, 1024);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Add Output Action to Flow mod</span></div>
<div class="line">fm.add_action(oa);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Creates Set Vlan ID action with vlan id=12 and add to Flow Mod </span></div>
<div class="line">fm.add_action(<span class="keyword">new</span> <a class="code" href="classfluid__msg_1_1of10_1_1SetVLANVIDAction.html">of10::SetVLANVIDAction</a>(12));</div>
</div><!-- fragment --><p> The example creates a <a class="el" href="classfluid__msg_1_1of10_1_1FlowMod.html">fluid_msg::of10::FlowMod</a> message with all fields wildcarded and with two actions. Notice that we are passing static and dynamic objects to the <a class="el" href="classfluid__msg_1_1of10_1_1FlowMod.html">fluid_msg::of10::FlowMod</a> class. The class takes ownership of the objects, deleting objects dinamically allocated. So the user should not delete that memory.</p>
<p>To create a <a class="el" href="classfluid__msg_1_1of13_1_1FlowMod.html">fluid_msg::of13::FlowMod</a>, with OXM Fields of13::InPort and of13::EthType; and with and of13::ApplyActions instruction containing the action of13::OutputAction:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;fluid/of13msg.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span>fluid_msg;</div>
<div class="line"></div>
<div class="line">[...]</div>
<div class="line"></div>
<div class="line"><a class="code" href="classfluid__msg_1_1of13_1_1FlowMod.html">of13::FlowMod</a> fm();</div>
<div class="line"></div>
<div class="line"><span class="comment">// Creates in_port oxm_field with value=1</span></div>
<div class="line"><a class="code" href="classfluid__msg_1_1of13_1_1InPort.html">of13::InPort</a> *port = <span class="keyword">new</span> InPort(1);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Add in_port to Flow Mod</span></div>
<div class="line">fm.add_oxm_field(port);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Create eth_type oxm_field with value=0x0800 and add to Flow Mod</span></div>
<div class="line">fm.add_oxm_field(<span class="keyword">new</span> <a class="code" href="classfluid__msg_1_1of13_1_1EthType.html">of13::EthType</a>(0x0800));</div>
<div class="line"></div>
<div class="line"><span class="comment">// Creates Output Action with in_port=1 and send_len=1024</span></div>
<div class="line"><a class="code" href="classfluid__msg_1_1of13_1_1OutputAction.html">of13::OutputAction</a> act(out_port, 1024);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Creates ApplyAction and add action</span></div>
<div class="line"><a class="code" href="classfluid__msg_1_1of13_1_1ApplyActions.html">of13::ApplyActions</a> inst; </div>
<div class="line">inst.add_action(act);</div>
<div class="line"><span class="comment">//Add the ApplyAction to FlowMod</span></div>
<div class="line">fm.add_instruction(inst);</div>
</div><!-- fragment --> </div></div><!-- contents -->
<script type="text/javascript">
$("table.directory td.desc").remove();
</script>
